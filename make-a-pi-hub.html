<!DOCTYPE HTML>
<html>
  <head>
    <title>diyActive: Make a Raspberry Pi Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style/main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.13.4/ui-bootstrap-tpls.min.js"></script>
    <script type="text/javascript" src="js/diyactive.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-49659454-2', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body ng-app="diyActive">
    <div ng-controller="InteractionCtrl">
      <nav class="navbar navbar-default" role="navigation">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle"
                  ng-init="navCollapsed = true"
                  ng-click="navCollapsed = !navCollapsed">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://context.reelyactive.com">
            <strong>reely</strong>Active
          </a>
        </div>
        <div class="collapse navbar-collapse" ng-class="!navCollapsed && 'in'"
             ng-click="navCollapsed = true">
          <ul class="nav navbar-nav navbar-right">
            <li class="active"><a href="index.html"> diyActive </a></li>
            <li class="dropdown" dropdown on-toggle="toggled(open)">
              <a href class="dropdown-toggle" dropdown-toggle role="button"
                 data-toggle="dropdown" aria-haspopup="true"
                 aria-expanded="false">
                Quick links <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a href="https://github.com/reelyactive/" target="_blank">
                    reelyActive on GitHub
                  </a>
                </li>
                <li>
                  <a href="https://www.npmjs.com/~reelyactive" target="_blank">
                    reelyActive on npmjs
                  </a>
                </li>
                <li role="separator" class="divider"></li>
                <li>
                  <a href="http://www.hyperlocalcontext.com" target="_blank">
                    www.hyperlocalcontext.com
                  </a>
                </li>
                <li>
                  <a href="http://smartspac.es" target="_blank">
                    smartspac.es
                  </a>
                </li>
                <li role="separator" class="divider"></li>
                <li>
                  <a href="http://shop.reelyactive.com" target="_blank">
                    Our online store
                  </a>
                </li>
                <li>
                  <a href="http://context.reelyactive.com" target="_blank">
                    Our website
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </nav>
      <div class="container-fluid">
        <div class="row">
          <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3"></div>
          <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <h1> Make a Raspberry Pi hub </h1>
            <p> In order for <a href="http://shop.reelyactive.com/collections/infrastructure" target="_blank">reelceivers</a> to communicate their data over a network and/or the Internet, they need to connect via a hub. </p>
            <img src="images/piHub-connected.jpg"
                 class="img-responsive center-block">
            <p> A Pi hub provides power to the reelceivers and converts their serial data packets into IP data packets using our open source software for Node.js.  And, if your Pi has an integrated BLE radio, it can even work standalone! </p>
            <div class="well">
              <div class="row">
                <div class="col-xs-12 col-sm-4">
                  <a href="http://hackaday.com/2016/08/01/sniffing-bluetooth-devices-with-a-raspberry-pi/">
                    <img src="images/hackaday-pi-ble.jpg"
                         class="img-responsive center-block">
                  </a>
                </div>
                <div class="col-xs-12 col-sm-8"> 
                  <h2> As presented on Hackaday </h2>
                  <p> At the Eleventh HOPE conference, we showed off a standalone Raspberry Pi 3 Bluetooth Low Energy (BLE) sniffer to the Hackaday crew, which they found cool enough to share with their readers. </p>
                  <p> You'll find instructions below to replicate the setup and more, making use of the integrated BLE radio.  Just add power and network and you have yourself a versatile sub-$100 tool/toy! </p>
                  <a class="btn btn-primary" href="http://hackaday.com/2016/08/01/sniffing-bluetooth-devices-with-a-raspberry-pi/"
                     role="button"> Read the Hackaday Post </a>
                </div>
              </div>
            </div>
            <h2> Hardware Prerequisites </h2>
            <p> You'll need both a Raspberry Pi and our minimal starter kit, <i>unless</i> you intend to run standalone on a Pi with an integrated BLE radio (ex: Pi 3).  In that case, our starter kit is optional. </p>
            <p> Both items can be purchased by following the links below.  If you prefer to get your hands dirty with the reelyActive kit, you can also <a href="build-your-own-hub.html#usb-hub" target="_blank">Build your own USB Hub</a> and purchase <a href="http://shop.reelyactive.com/products/ra-r436" target="_blank">the reelceiver</a>.
            </p>
            <p class="text-center">
              <a class="btn btn-primary" role="button"
                 href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b/">
                Buy a Pi 3 </a> &nbsp;
              <a class="btn btn-primary" role="button"
                 href="http://shop.reelyactive.com/products/starterkit-min">
                Buy a Starter Kit </a>
            </p>
            <h2> Preparing the Pi </h2>
            <p> Assuming you're starting with an out-of-the-box Pi, the following preparation is required. </p>
            <h3> SD Card </h3>
            <p> The Pi's filesystem resides on an SD card.  If your Pi came with a prepared SD card, lucky you, you get to skip this step! </p>
            <p> The <a href="https://www.raspberrypi.org/help/quick-start-guide/" target="_blank">Quick Start Guide</a> suggests an 8GB class 4 SD card, which we encourage you to purchase from an established vendor.  If the card doesn't come formatted as FAT32, you'll need to do so (read the INSTRUCTIONS-README.txt included in the NOOBS ZIP file). </p>
            <p> <a href="https://www.raspberrypi.org/downloads/" target="_blank">Download NOOBS</a> and unzip the contents to the root folder of the SD card.  You're all set! </p>
            <h3> Initial Boot </h3>
            <p> Connect the following to your Pi:
              <ul>
                <li> the prepared SD card in its slot
                <li> a USB keyboard in one of the USB ports
                <li> a USB mouse in another USB port
                <li> a monitor via the HDMI port
              </ul>
            </p>
            <p> Then power the Pi through a <u>high-quality</u> USB power source (ex: phone charger).  Follow the instructions on screen to install the Raspbian operating system.  This procedure will take some time.  Perhaps enjoy a slice or two of delicious raspberry pie while you wait? </p>
            <h3> Connect to Network </h3>
            <p> After Raspbian boots, connect the Pi to the Internet via either WiFi or Ethernet using the on-screen tools.  The Pi is ready! </p> 
            <h2> Install Node.js </h2>
            <p> Raspbian will likely include an old version of Node.js.  Here we'll provide the instructions for installing the latest LTS (long term support version) which will be required.  Open a terminal on the Pi and execute the following in order (optionally change 4.4.7 below throughout to the latest LTS version as indicated <a href="https://nodejs.org" target="_blank">here</a>): </p>
            <pre> 
wget https://nodejs.org/dist/v4.4.7/node-v4.4.7-linux-armv7l.tar.xz
tar -xf node-v4.4.7-linux-armv7l.tar.xz
sudo mv node-v4.4.7-linux-armv7l /usr/local/node
cd /usr/local/bin
sudo ln -s /usr/local/node/bin/node node
sudo ln -s /usr/local/node/bin/npm npm
            </pre>
            <p> Close and re-open the terminal.  Confirm that v4.4.7 appears when you run <code>node -v</code>.  Node.js is now installed. </p>
            <h2> Decide what to run </h2>
            <p> Now we have to choose among <a href="http://reelyactive.github.io/?tab=software" target="_blank">the many options of open source software</a> to run!  You can install any and all of the tab-selectable options below, but you'll typically run only one at a time. </p>
            <tabset>
              <tab heading="pi-suite (Hackaday)">
                <h2> Install pi-suite </h2>
                <p> <b>Select this option to run the <a href="http://hackaday.com/2016/08/01/sniffing-bluetooth-devices-with-a-raspberry-pi/" target="_blank">Hackaday-style</a> suite of software, standalone </b> (requires a Pi with integrated BLE). </p>
                <p> Open a terminal on the Pi and execute the following in order: </p>
                <pre> 
mkdir ~/reelyActive
cd ~/reelyActive
git clone https://github.com/reelyactive/pi-suite.git
cd pi-suite
npm install
                </pre>
                <p> This will fetch and install the open source code from our GitHub to a folder called reelyActive/pi-suite.  You can check out the code via the button below. </p>
                <p class="text-center">
                  <a class="btn btn-primary" role="button" 
                     href="https://github.com/reelyactive/pi-suite"
                     target="_blank"> Open pi-suite </a>
                </p>
                <h2> Run pi-suite </h2>
                <p> Open a terminal and run the following command: </p>
                <pre>sudo node /home/pi/reelyActive/pi-suite/pi-suite</pre> 
                <p> Within a few seconds you should see the a console message indicating the id to query the receiver.  <b>Note this id.</b> </p>
                <h3> (Optional) Auto-Run on Boot </h3>
                <p> The following (optional) steps configure the Pi to run pi-suite automatically (in the background) on boot, based on <a href="https://www.raspberrypi.org/documentation/linux/usage/rc-local.md" target="_blank">this tutorial</a>.  This is useful for a standalone, headless installation where power interruptions may occur. </p>
                <h4> Install forever </h4>
                <p> First we'll install the forever package globally, which allows us to keep our programs running <i>forever</i>, restarting them automatically should they crash.  Open a terminal on the Pi and execute the following in order: </p>
                <pre>
sudo npm install forever -g
cd /usr/local/bin
sudo ln -s /usr/local/node/bin/forever forever
                </pre> 
                <h4> Update /etc/rc.local </h4>
                <p> Open a terminal on the Pi and run the following command: </p>
                <pre>sudo nano /etc/rc.local</pre>
                <p> Edit the file by adding <code>sudo forever start /home/pi/reelyActive/pi-suite/pi-suite.js &</code> above <code>exit 0</code>.  Then press Ctrl-X to exit, and Y to save. </p>
                <p> Reboot and confirm that, once Raspbian boots, there is activity on the starter kit USB hub's LED indicating that execution of the progam has started. </p>
                <h2> Browse the Hyperlocal Context </h2>
                <p> If your Pi is connected to a keyboard, mouse and display, browse to <i>http://localhost</i> to see the Hyperlocal Context page. </p>
                <p> Otherwise, browse to your Pi over the network via its IP address.  For instance, if the Pi's IP address is 12.34.56.78 you would browse to <i>http://12.34.56.78</i>.  To learn the Pi's IP address, run <code>ifconfig</code> in the console. </p>
                <h3> Query your Pi </h3>
                <p> The Hyperlocal Context page will show the number of BLE packets and devices it is processing, and will allow you to query the BLE receiver on your Pi.  In the search bar, <b>enter the id you noted from the console earlier.</b> </p>
                <img src="images/piHub-hlc.png"
                     class="img-responsive center-block">
                <h4> What at receiver id </h4>
                <p> This query will return the most recent BLE packet of each device received by the Pi. </p>
                <h4> Context at receiver id </h4>
                <p> This query will return a contextual representation of all the devices detected by the Pi. </p>
                <h3> (Optional) Boot into Kiosk Mode </h3>
                <p> The following (optional) steps configure the Pi to open a full-screen browser on boot.  This is useful for a standalone Pi connected to a display. </p>
                <p> Open a terminal on the Pi and run the following command which installs a package that facilitates running the browser in full-screen mode: </p>
                <pre>sudo apt-get install matchbox-window-manager</pre>
                <p> Run the following command: </p>
                <pre>sudo nano /etc/rc.local </pre>
                <p> Edit the file by adding <code>sleep 30; sudo xinit /home/pi/reelyActive/pi-suite/display &</code> above <code>exit 0</code> (just below the optional Auto-Run on Boot line added earlier) </p>
                <p> Then configure the Pi to boot into a console.  Run from the command line: </p>
                <pre>sudo raspi-config</pre>
                <p> Then from the Boot Options menu select Console Autologin.  Select Finish and then accept the option to reboot. </p>
                <p> Observe that the Pi boots into a console, pauses, and then opens the browser full-screen.  It should do this after every power cycle.  You can change the default boot page by editing the /pi-suite/display file. </p> 
                <h2> But wait, there's more! </h2>
                <p> The code that is running also enables the following features: </p>
                <ul>
                  <li> all events are logged to a file in the local directory called eventlog-############.csv
                  <li> all events are available in real-time using socket.io (on <i>http://localhost/events</i>)
                </ul>
                <p> Easily create your own custom dashboard using the socket.io feed and our <a href="https://github.com/reelyactive/dashboard-template-angular" target="_blank">dashboard-template-angular</a> code.  And of course, don't hesitate to <a href="http://context.reelyactive.com/contact.html" target="_blank">get in touch</a> if you'd like to share your complementary projects. </p>
              </tab>
              <tab heading="pi-relay">
                <h2> Install pi-relay </h2>
                <p> <b>Select this option to stream the real-time data to a remote server such as <a href="http://getpareto.com" target="_blank">Pareto</a> </b> (a trial of which is included with the purchase of a starter kit). </p>
                <p> Open a terminal on the Pi and execute the following in order: </p>
                <pre> 
mkdir ~/reelyActive
cd ~/reelyActive
git clone https://github.com/reelyactive/pi-relay.git
cd pi-relay
npm install
                </pre>
                <p> This will fetch and install the open source code from our GitHub to a folder called reelyActive/pi-relay.  You can check out the code via the button below. </p>
                <p class="text-center">
                  <a class="btn btn-primary" role="button" 
                     href="https://github.com/reelyactive/pi-relay"
                     target="_blank"> Open pi-relay </a>
                </p>
                <h2> Run pi-relay </h2>
                <p> With the minimal starter kit connected to the USB port of the Pi, open a terminal and run the following command: </p>
                <pre>node /home/pi/reelyActive/pi-relay/pi-relay</pre> 
                <p> Within a few seconds you should see a stream of decodings printed to the console. </p>
                <h3> (Optional) Auto-Run on Boot </h3>
                <p> The following (optional) steps configure the Pi to run pi-relay automatically (in the background) on boot, based on <a href="https://www.raspberrypi.org/documentation/linux/usage/rc-local.md" target="_blank">this tutorial</a>.  This is useful for a standalone, headless installation where power interruptions may occur. </p>
                <p> Open a terminal on the Pi and run the following command: </p>
                <pre>sudo nano /etc/rc.local</pre>
                <p> Edit the file by adding <code>node /home/pi/reelyActive/pi-relay/pi-relay &</code> above <code>exit 0</code>.  Then press Ctrl-X to exit, and Y to save. </p>
                <p> Reboot and confirm that, once Raspbian boots, there is activity on the starter kit USB hub's LED indicating that execution of the progam has started. </p>
              </tab>
            </tabset>
            <hr>
            <h2> What's next? </h2>
            <p> Our starter kits include a three-month trial of our <a href="http://getpareto.com" target="_blank">Pareto platform</a> which is the easiest way to put your data to good use.  Also, if you build your own unique hub and would like to share your project, <a href="http://context.reelyactive.com/contact.html" target="_blank">please get in touch</a>! </p>
            <p class="text-center">
              <a class="btn btn-default" href="make-a-tessel-hub.html"
                 role="button"> Make a Tessel Hub </a>
              <a class="btn btn-success" href="index.html"
                 role="button"> Return to diyActive </a>
            </p>
          </div>
          <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3"></div>
        </div>
      </div>
      <footer class="footer">
        <a href="index.html"> diyActive </a> &nbsp; | &nbsp;
        <a href="http://context.reelyactive.com">
          &copy; reelyActive 2016
        </a>
      </footer>
    </div>
  </body>
</html>
